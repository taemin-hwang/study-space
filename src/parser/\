/*
 * ConfigParser.cpp
 *
 *  Created on: 2020. 2. 26.
 *      Author: taemin.hwang
 */

#include <iostream>
#include <cstdio>
#include "parser/ConfigParser.h"

using namespace rapidjson;

namespace parser {

ConfigParser::ConfigParser(std::string s) {
    FILE* fp = fopen(s.c_str(), "rb");
    if(fp == 0) {
        std::cout << "file not exist : default param will be used" << std::endl;
        return;
    }
    char readbuffer[65536];
    filereadstream is(fp, readbuffer, sizeof(readbuffer));

    document document;
    document.parsestream(is);

    fclose(fp);

    if(document.hasmember("ipaddr") && document["ipaddr"].isstring()) {
        cfg_.ipaddr = document["ipaddr"].getstring();
    }
    if(document.hasmember("version") && document["version"].isint()) {
        cfg_.ipversion = document["version"].getint();
    }
    if(document.hasmember("port") && document["port"].isint()) {
        cfg_.port = document["port"].getint();
    }
}

ConfigParser::~ConfigParser() {

}

config ConfigParser::getcfg() {

    return cfg_;
}

} /* namespace parser */
